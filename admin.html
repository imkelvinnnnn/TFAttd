<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TF Attendance Admin</title>
    <style>
        :root {
            --bg: #f3f4f6;
            --surface: #ffffff;
            --card: #ffffff;
            --card-soft: #f9fafb;
            --border-subtle: rgba(148, 163, 184, 0.35);
            --primary: #2563eb;
            --primary-soft: rgba(37, 99, 235, 0.08);
            --primary-strong: #1d4ed8;
            --accent: #16a34a;
            --danger: #b91c1c;
            --text-main: #111827;
            --text-muted: #6b7280;
        }

        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            min-height: 100vh;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: radial-gradient(circle at top left, rgba(129, 140, 248, 0.25) 0, transparent 58%),
                radial-gradient(circle at bottom right, rgba(45, 212, 191, 0.18) 0, transparent 55%),
                var(--bg);
            color: var(--text-main);
        }

        .page-shell {
            max-width: 1120px;
            margin: 0 auto;
            padding: 16px 16px 24px;
        }

        header.app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            gap: 12px;
        }

        .brand-block {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .brand-logo {
            width: 34px;
            height: 34px;
            border-radius: 999px;
            background: conic-gradient(from 180deg, #22c55e, #22c55e, #2563eb, #22c55e);
            padding: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .brand-logo-inner {
            width: 100%;
            height: 100%;
            border-radius: inherit;
            background: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-weight: 700;
            font-size: 0.8rem;
        }

        .brand-text-main {
            font-weight: 600;
            letter-spacing: 0.03em;
            font-size: 0.9rem;
            text-transform: uppercase;
            color: var(--text-muted);
        }

        .brand-text-sub {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .header-meta {
            text-align: right;
            font-size: 0.78rem;
            color: var(--text-muted);
        }

        .header-meta span {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 999px;
            background: #e5edff;
            border: 1px solid rgba(37, 99, 235, 0.45);
            color: #1d4ed8;
        }

        .layout-main {
            display: block;
        }

        @media (min-width: 900px) {
            .page-shell {
                padding: 20px 20px 28px;
            }
        }

        .card {
            background: var(--surface);
            border-radius: 18px;
            padding: 16px 16px 18px;
            border: 1px solid rgba(209, 213, 219, 0.9);
            box-shadow: 0 18px 45px rgba(15, 23, 42, 0.08);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            gap: 10px;
            margin-bottom: 10px;
        }

        .card-title {
            font-size: 1.2rem;
            margin: 0;
        }

        .card-subtitle {
            margin: 0;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        @media (min-width: 600px) {
            .card {
                padding: 18px 18px 20px;
            }

            .card-title {
                font-size: 1.35rem;
            }
        }

        .toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }

        .btn {
            appearance: none;
            border: none;
            border-radius: 999px;
            padding: 9px 14px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: background 0.15s ease, transform 0.05s ease, box-shadow 0.15s ease, border-color 0.15s ease;
            white-space: nowrap;
        }

        .btn span.icon-dot {
            width: 7px;
            height: 7px;
            border-radius: 999px;
            background: #bbf7d0;
        }

        .btn-primary {
            background: linear-gradient(to bottom right, #2563eb, #1d4ed8);
            color: #f9fafb;
            box-shadow: 0 10px 26px rgba(37, 99, 235, 0.4);
            border: 1px solid rgba(37, 99, 235, 0.7);
        }

        .btn-primary:hover {
            background: linear-gradient(to bottom right, #1d4ed8, #1d4ed8);
            transform: translateY(-1px);
            box-shadow: 0 16px 36px rgba(37, 99, 235, 0.98);
        }

        .btn-primary:active {
            transform: translateY(0);
            box-shadow: 0 8px 22px rgba(37, 99, 235, 0.9);
        }

        .btn-secondary {
            background: #ffffff;
            color: var(--text-main);
            border: 1px solid rgba(148, 163, 184, 0.6);
        }

        .btn-secondary:hover {
            background: rgba(15, 23, 42, 0.98);
            transform: translateY(-1px);
        }

        .btn-secondary:active {
            transform: translateY(0);
        }

        .btn-danger {
            background: #fee2e2;
            color: #b91c1c;
            border: 1px solid rgba(248, 113, 113, 0.9);
        }

        .btn-danger:hover {
            background: rgba(185, 28, 28, 1);
            transform: translateY(-1px);
        }

        .btn-danger:active {
            transform: translateY(0);
        }

        .count-pill {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 9px;
            border-radius: 999px;
            font-size: 0.75rem;
            background: #eef2ff;
            border: 1px solid rgba(129, 140, 248, 0.8);
            color: #3730a3;
        }

        .subtitle {
            font-size: 0.82rem;
            color: var(--text-muted);
            margin: 0 0 8px;
        }

        .loader {
            font-size: 0.85rem;
            color: var(--text-muted);
            padding: 10px 0;
        }

        .empty-state {
            display: none;
            margin-top: 14px;
            padding: 10px 12px;
            border-radius: 12px;
            background: #ecfdf3;
            border: 1px solid rgba(22, 163, 74, 0.4);
            color: #166534;
            font-size: 0.9rem;
        }

        .list-container {
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 60vh;
            overflow-y: auto;
            padding-right: 4px;
        }

        .person-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            border-radius: 999px;
            background: #f9fafb;
            border: 1px solid rgba(209, 213, 219, 0.9);
            transition: transform 0.12s ease, background 0.15s ease, border-color 0.15s ease, opacity 0.2s ease;
        }

        .person-card:hover {
            transform: translateY(-1px);
            background: #eef2ff;
            border-color: rgba(129, 140, 248, 0.9);
        }

        .person-name {
            font-size: 0.95rem;
        }

        .mark-btn {
            border-radius: 999px;
            border: none;
            background: rgba(22, 163, 74, 0.16);
            color: #166534;
            font-size: 0.9rem;
            padding: 8px 14px;
            min-width: 120px;
            cursor: pointer;
            transition: background 0.15s ease, transform 0.05s ease, box-shadow 0.15s ease;
            box-shadow: 0 4px 10px rgba(22, 163, 74, 0.2);
        }

        .mark-btn:hover {
            background: rgba(22, 163, 74, 0.24);
            transform: translateY(-1px);
            box-shadow: 0 6px 14px rgba(22, 163, 74, 0.28);
        }

        .mark-btn:active {
            transform: translateY(0);
            box-shadow: 0 3px 8px rgba(22, 163, 74, 0.25);
        }

        .stats-card {
            margin-top: 8px;
            padding: 10px 12px;
            font-size: 0.82rem;
            border-radius: 12px;
            background: var(--card-soft);
            border: 1px solid rgba(209, 213, 219, 0.9);
        }

        .stats-header {
            margin-bottom: 6px;
        }

        .stats-title {
            margin: 0;
            font-size: 0.9rem;
            color: var(--text-main);
        }

        .stats-body {
            display: flex;
            flex-wrap: wrap;
            gap: 6px 16px;
        }

        .stats-body p {
            margin: 0;
            color: var(--text-muted);
        }

        .stats-body strong {
            color: var(--text-main);
        }

        #statsBox {
            display: none;
        }
    </style>
</head>

<body>

    <div class="page-shell">
        <header class="app-header">
            <div class="brand-block">
                <div class="brand-logo">
                    <div class="brand-logo-inner">TF</div>
                </div>
                <div>
                    <div class="brand-text-main">TF Attendance ¬∑ Admin</div>
                    <div class="brand-text-sub">ÁÆ°ÁêÜÂ∞ëÂπ¥Âõ¢Âá∫Â∏≠ ¬∑ ‰ªäÊó•Áº∫Â∏≠ÂêçÂçï</div>
                </div>
            </div>
            <div class="header-meta">
                <span>
                    <small>Today</small>
                    <strong id="todayDate"></strong>
                </span>
            </div>
        </header>

        <main class="layout-main">
            <section class="card">
                <div class="card-header">
                    <div>
                        <h2 class="card-title">‚ö†Ô∏è Missing List</h2>
                        <p class="card-subtitle">Mark teens as present as they arrive.</p>
                    </div>
                    <div class="count-pill">
                        <span id="countDisplay">Checking...</span>
                    </div>
                </div>

                <div class="toolbar">
                    <button class="btn btn-danger" onclick="markAllAbsent()">
                        <span class="icon-dot"></span>
                        <span>Mark remaining as 0</span>
                    </button>
                    <button class="btn btn-primary" onclick="generateStats()">
                        <span class="icon-dot"></span>
                        <span>Generate today‚Äôs stats</span>
                    </button>
                </div>

                <aside id="statsBox" class="stats-card">
                <div class="stats-header">
                    <h3 class="stats-title">‰ªäÊó•Âá∫Â∏≠ÁªüËÆ°</h3>
                </div>
                <div class="stats-body">
                    <p>Âá∫Â∏≠ÊÄª‰∫∫Êï∞: <strong id="statTotal">0</strong></p>
                    <p>Â∞ëÂπ¥‰∫∫: <strong id="statTeens">0</strong></p>
                    <p>ÂøóÂ∑• &amp; ÂØºÂ∏à: <strong id="statMentors">0</strong></p>
                </div>
                </aside>

                <p class="subtitle">Only those who have not checked in yet will appear below.</p>

                <div id="loader" class="loader">Loading data‚Ä¶</div>
                <div id="emptyState" class="empty-state">üéâ Everyone is present! No one outstanding today.</div>
                <div id="listContainer" class="list-container"></div>
            </section>
        </main>
    </div>

    <script>
        // üî¥ PASTE YOUR SAME GOOGLE SCRIPT URL HERE üî¥
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwqGl_u5uGICQ6kB_uUDveGLCL7MQW_WahwYE5yTDNBX71P6CJRScTOGom_zeCDYHe-sw/exec";

        // Load missing people on start
        window.onload = function () {

            // This will format the date as 1/2/2026
            const today = new Date();
            const dateString = today.getDate() + '/' + (today.getMonth() + 1) + '/' + today.getFullYear();

            document.getElementById("todayDate").innerText = dateString;

            fetch(SCRIPT_URL + "?action=getMissing")
                .then(response => response.json())
                .then(data => {
                    document.getElementById("loader").style.display = "none";

                    if (data.result === "error") {
                        alert("Error: " + data.message);
                        return;
                    }

                    renderList(data.data);
                })
                .catch(err => alert("Connection Failed"));
        };

        function renderList(names) {
            const container = document.getElementById("listContainer");
            const countDisplay = document.getElementById("countDisplay");
            const emptyState = document.getElementById("emptyState");

            // Update Count
            countDisplay.innerText = names.length + " people outstanding";

            // If everyone is here
            if (names.length === 0) {
                emptyState.style.display = "block";
                return;
            }

            // Generate Buttons
            names.forEach(name => {
                let card = document.createElement("div");
                card.className = "person-card";
                card.id = "card-" + name; // Unique ID to remove it later

                let nameSpan = document.createElement("span");
                nameSpan.className = "person-name";
                nameSpan.innerText = name;

                let btn = document.createElement("button");
                btn.className = "mark-btn";
                btn.innerText = "Mark Present";
                btn.onclick = function () { markPerson(name, btn); };

                card.appendChild(nameSpan);
                card.appendChild(btn);
                container.appendChild(card);
            });
        }

        function markPerson(name, btnElement) {
            if (!confirm("Mark " + name + " as Present?")) return;

            // UI Loading State
            btnElement.innerText = "...";
            btnElement.disabled = true;

            fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: "name=" + encodeURIComponent(name)
            })
                .then(() => {
                    // Success: Animate and Remove the card
                    const card = document.getElementById("card-" + name);
                    card.style.opacity = "0";
                    setTimeout(() => card.remove(), 300); // Wait for fade out

                    // Update the counter
                    updateCount();
                })
                .catch(err => {
                    alert("Failed to mark attendance.");
                    btnElement.innerText = "Mark Present";
                    btnElement.disabled = false;
                });
        }

        function updateCount() {
            const countDisplay = document.getElementById("countDisplay");
            const remaining = document.querySelectorAll(".person-card").length - 1; // -1 because we just removed one

            if (remaining <= 0) {
                countDisplay.innerText = "0 people outstanding";
                document.getElementById("emptyState").style.display = "block";
            } else {
                countDisplay.innerText = remaining + " people outstanding";
            }
        }

        // Define your mentors here
        const MENTOR_NAMES = ["Êú±ËäØËñá", "ÈôàÂ≠¶Áùø", "ÈªÑ‰Ω©Áõà", "ÊûóÊóªÈúá", "ÊùéÈùñË®Ä", "Êú±Ëä∑Ëñá", "Êù®ÊôãÊÅ©", "Ëî°Ê≠£ÂÆâ", "Âë®ÂáØËç£", "Âº†ÊÇ†Êâ¨", "ÂßöËèÄÂ©∑", "Êú±ÂáØ‰ª™", "ÈôàÊò≠ÂÇß", "ÂßöÊù∞ÊÅí", "ÂæêÈì≠Áæé"];

        function markAllAbsent() {
            if (!confirm("This will mark everyone not present as '0'. Continue?")) return;

            fetch(SCRIPT_URL + "?action=markAbsent")
                .then(r => r.json())
                .then(data => {
                    if (data.result === "success") {
                        alert("All missing people marked as 0");
                        location.reload(); // Refresh to clear the list
                    }
                });
        }

        function generateStats() {
            const mentorParams = encodeURIComponent(MENTOR_NAMES.join(","));

            fetch(SCRIPT_URL + "?action=getStats&mentors=" + mentorParams)
                .then(r => r.json())
                .then(data => {
                    document.getElementById("statsBox").style.display = "block";
                    document.getElementById("statTotal").innerText = data.total;
                    document.getElementById("statTeens").innerText = data.teens;
                    document.getElementById("statMentors").innerText = data.mentors;
                })
                .catch(err => alert("Could not generate stats."));
        }

        
    </script>

</body>

</html>